\usepackage{couriers}
\usepackage{listings}
\usepackage{xcolor}

\definecolor{codehighlight}{rgb}{0.827,0.322,0.07}

\newcommand{\lstinputlistinghl}[3][]{%
  \lstinputlisting[%
    belowskip=0pt,
    lastline=\number\numexpr#2-1\relax,
    showlines=true,
    #1
  ]{#3}%
  \lstinputlisting[%
    aboveskip=0pt,
    belowskip=0pt,
    backgroundcolor=\color{codehighlight!15},
    firstline=#2,
    lastline=#2
  ]{#3}
  \lstinputlisting[%
    aboveskip=0pt,
    firstline=\number\numexpr#2+1\relax
  ]{#3}
}

\newcommand{\emcode}[1]{\bfseries\color{codehighlight}{#1}}

\lstset{
backgroundcolor=\color{black!5},
basicstyle=\ttfamily\small,
emphstyle=\bfseries\color{codehighlight},
escapechar=@,
extendedchars=\true,
frame=single,
inputencoding=utf8x,
language=c++,
literate={~} {$\sim$}{1},
rulecolor=\color{black!20},
showstringspaces=\false
}
